<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Argument Quality Review - Dharmasikhara Assessment</title>
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --accent-color: #e74c3c;
            --light-color: #ecf0f1;
            --dark-color: #34495e;
            --success-color: #27ae60;
            --warning-color: #f39c12;
            --danger-color: #c0392b;
            --gray-color: #95a5a6;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: #f5f7fa;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background: linear-gradient(135deg, var(--primary-color), var(--dark-color));
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            text-align: center;
        }
        
        h1 {
            font-size: 2rem;
            margin-bottom: 10px;
        }
        
        .subtitle {
            font-size: 1.1rem;
            opacity: 0.9;
        }
        
        .assessment-info {
            display: flex;
            justify-content: space-between;
            background-color: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        
        .timer, .progress {
            font-weight: bold;
        }
        
        .progress-bar {
            height: 10px;
            background-color: #eee;
            border-radius: 5px;
            margin-top: 5px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--secondary-color), var(--accent-color));
            width: 0%;
            transition: width 0.3s ease;
        }
        
        .content-area {
            background-color: white;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        
        .section-title {
            color: var(--primary-color);
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--secondary-color);
        }
        
        .question-container {
            margin-bottom: 30px;
            padding: 20px;
            border-radius: 8px;
            background-color: #f8f9fa;
        }
        
        .question-text {
            font-size: 1.1rem;
            margin-bottom: 15px;
            font-weight: 500;
        }
        
        .options-container {
            margin-top: 15px;
        }
        
        .option {
            display: block;
            padding: 12px 15px;
            margin-bottom: 10px;
            border: 1px solid #ddd;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .option:hover {
            background-color: #e3f2fd;
            border-color: var(--secondary-color);
        }
        
        .option.selected {
            background-color: var(--secondary-color);
            color: white;
            border-color: var(--secondary-color);
        }
        
        textarea {
            width: 100%;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            font-size: 1rem;
            resize: vertical;
            min-height: 150px;
        }
        
        .btn-container {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
        }
        
        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        
        .btn-prev {
            background-color: var(--gray-color);
            color: white;
        }
        
        .btn-submit {
            background-color: var(--success-color);
            color: white;
        }
        
        .btn:hover {
            opacity: 0.9;
            transform: translateY(-2px);
        }
        
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        
        .clue-btn {
            background-color: var(--warning-color);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9rem;
            margin-top: 10px;
        }
        
        .clue-btn:hover {
            opacity: 0.9;
        }
        
        .clue-warning {
            display: none;
            background-color: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 6px;
            padding: 15px;
            margin-top: 10px;
            color: #856404;
        }
        
        .clue-content {
            display: none;
            background-color: #d4edda;
            border: 1px solid #c3e6cb;
            border-radius: 6px;
            padding: 15px;
            margin-top: 10px;
            color: #155724;
        }
        
        .incorrect-answer {
            background-color: #f8d7da;
            border: 1px solid #f5c6cb;
        }
        
        footer {
            text-align: center;
            margin-top: 30px;
            padding: 20px;
            color: var(--gray-color);
            font-size: 0.9rem;
        }
        
        @media (max-width: 768px) {
            .assessment-info {
                flex-direction: column;
                gap: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Dharmasikhara Legal Competency Assessment</h1>
            <div class="subtitle">Section D: Argument Quality Review</div>
        </header>
        
        <div class="assessment-info">
            <div class="timer">
                Time Remaining: <span id="time-display">25:00</span>
            </div>
            <div class="progress">
                Progress: <span id="progress-text">0/2</span>
                <div class="progress-bar">
                    <div class="progress-fill" id="progress-fill"></div>
                </div>
            </div>
        </div>
        
        <div class="content-area">
            <h2 class="section-title">Argument Quality Review (25% of total assessment)</h2>
            
            <div class="question-container">
                <div class="question-text">
                    Q1. [Argument Deconstruction] Read this bail argument excerpt: "Your Honor, my client is innocent. The CCTV footage is unclear, and the police investigation was rushed. Many people have access to that room. Bail should be granted because the evidence is weak." Identify THREE specific weaknesses and rewrite the argument to address them.
                </div>
                <div class="options-container">
                    <div class="option" data-question="q1" data-value="0">
                        Asserts innocence (inappropriate at bail stage)
                    </div>
                    <div class="option" data-question="q1" data-value="1">
                        Lacks specific legal standard for bail
                    </div>
                    <div class="option" data-question="q1" data-value="2">
                        No affirmative facts supporting client's reliability
                    </div>
                </div>
                <button class="clue-btn" data-question="q1">Show Clue</button>
                <div class="clue-warning" id="clue-warning-q1">
                    <strong>Warning:</strong> Using this clue will result in receiving only half marks for this question.
                    <button class="btn" onclick="showClue('q1')">Continue</button>
                    <button class="btn btn-prev" onclick="hideClueWarning('q1')">Cancel</button>
                </div>
                <div class="clue-content" id="clue-content-q1">
                    <strong>Clue:</strong> Consider what a proper bail argument should include and avoid.
                </div>
            </div>
            
            <div class="question-container">
                <div class="question-text">
                    Q2. [Reflective Practice] During the scenario, you chose to [USER'S ACTUAL CHOICE: e.g., "aggressively cross-examine the security guard"]. Explain: Why you made this decision (strategic reasoning); What legal principle or tactical advantage you sought; How you would adjust this approach if the judge had warned against aggressive tactics.
                </div>
                <textarea id="q2-textarea" placeholder="Enter your response (150-250 words)"></textarea>
                <button class="clue-btn" data-question="q2">Show Clue</button>
                <div class="clue-warning" id="clue-warning-q2">
                    <strong>Warning:</strong> Using this clue will result in receiving only half marks for this question.
                    <button class="btn" onclick="showClue('q2')">Continue</button>
                    <button class="btn btn-prev" onclick="hideClueWarning('q2')">Cancel</button>
                </div>
                <div class="clue-content" id="clue-content-q2">
                    <strong>Clue:</strong> Think about effective advocacy techniques and when to use them.
                </div>
            </div>
            
            <div class="btn-container">
                <button class="btn btn-prev" id="prev-section">Previous Section</button>
                <button class="btn btn-submit" id="submit-assessment" disabled>Submit Assessment</button>
            </div>
        </div>
        
        <footer>
            <p>Dharmasikhara Legal Competency Assessment System</p>
            <p>Contact: kkavyaammulu@gmail.com | +91 7019357082</p>
        </footer>
    </div>

    <script>
        // Initialize section state
        const sectionState = {
            totalQuestions: 2,
            answeredQuestions: 0,
            responses: {},
            cluesUsed: {},
            timeRemaining: 25 * 60 // 25 minutes in seconds for Argument Quality section
        };

        // DOM elements
        const timeDisplay = document.getElementById('time-display');
        const progressText = document.getElementById('progress-text');
        const progressFill = document.getElementById('progress-fill');
        const prevSectionBtn = document.getElementById('prev-section');
        const submitBtn = document.getElementById('submit-assessment');
        const optionElements = document.querySelectorAll('.option');
        const clueButtons = document.querySelectorAll('.clue-btn');
        const q2Textarea = document.getElementById('q2-textarea');

        // Initialize the section
        function initSection() {
            // Set up option selection
            optionElements.forEach(option => {
                option.addEventListener('click', handleOptionSelect);
            });

            // Set up textarea inputs
            q2Textarea.addEventListener('input', function() {
                sectionState.responses['q2'] = q2Textarea.value;
                updateProgress();
            });

            // Set up clue buttons
            document.querySelectorAll('.clue-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const questionId = this.dataset.question;
                    showClueWarning(questionId);
                });
            });

            // Set up navigation buttons
            prevSectionBtn.addEventListener('click', goToPreviousSection);
            submitBtn.addEventListener('click', submitAssessment);

            // Start timer
            startTimer();
            
            // Initialize time display with correct time
            const minutes = Math.floor(sectionState.timeRemaining / 60);
            const seconds = sectionState.timeRemaining % 60;
            timeDisplay.textContent = `${minutes}:${seconds < 10 ? '0' : ''}${seconds}`;
            
            // Load previous responses if any
            const savedResponses = localStorage.getItem('argument_quality_responses');
            if (savedResponses) {
                sectionState.responses = JSON.parse(savedResponses);
                // Restore UI selections
                Object.keys(sectionState.responses).forEach(questionId => {
                    if (questionId === 'q1') {
                        // Multi-select question
                        if (Array.isArray(sectionState.responses[questionId])) {
                            sectionState.responses[questionId].forEach(value => {
                                const option = document.querySelector(`[data-question="${questionId}"][data-value="${value}"]`);
                                if (option) {
                                    option.classList.add('selected');
                                }
                            });
                        }
                    } else if (questionId === 'q2') {
                        // Textarea question
                        q2Textarea.value = sectionState.responses[questionId];
                    }
                });
                updateProgress();
            }
            
            // Load clues used if any
            const savedClues = localStorage.getItem('argument_quality_clues');
            if (savedClues) {
                sectionState.cluesUsed = JSON.parse(savedClues);
                // Show clues that were previously used
                Object.keys(sectionState.cluesUsed).forEach(questionId => {
                    if (sectionState.cluesUsed[questionId]) {
                        document.getElementById(`clue-content-${questionId}`).style.display = 'block';
                        // Hide the clue button
                        const clueBtn = document.querySelector(`.clue-btn[data-question="${questionId}"]`);
                        if (clueBtn) clueBtn.style.display = 'none';
                    }
                });
            }
        }

        // Handle option selection
        function handleOptionSelect(event) {
            const option = event.target;
            const questionId = option.dataset.question;
            
            // For Q1, allow multiple selections (multi-select question)
            // Q1 has exactly 3 options, and users need to select all 3 to identify the THREE specific weaknesses
            if (questionId === 'q1') {
                // Toggle selection
                if (option.classList.contains('selected')) {
                    option.classList.remove('selected');
                    // Remove this value from responses
                    if (sectionState.responses['q1'] && Array.isArray(sectionState.responses['q1'])) {
                        const valueIndex = sectionState.responses['q1'].indexOf(parseInt(option.dataset.value));
                        if (valueIndex > -1) {
                            sectionState.responses['q1'].splice(valueIndex, 1);
                        }
                    }
                } else {
                    option.classList.add('selected');
                    // Add this value to responses
                    if (!sectionState.responses['q1']) {
                        sectionState.responses['q1'] = [];
                    }
                    if (Array.isArray(sectionState.responses['q1'])) {
                        sectionState.responses['q1'].push(parseInt(option.dataset.value));
                    }
                }
            } else {
                // For other questions, deselect others in the same question
                const siblings = document.querySelectorAll(`[data-question="${questionId}"]`);
                siblings.forEach(sib => sib.classList.remove('selected'));
                
                option.classList.add('selected');
                sectionState.responses[questionId] = parseInt(option.dataset.value);
            }
            
            updateProgress();
        }

        // Show clue warning
        function showClueWarning(questionId) {
            document.getElementById(`clue-warning-${questionId}`).style.display = 'block';
        }

        // Hide clue warning
        function hideClueWarning(questionId) {
            document.getElementById(`clue-warning-${questionId}`).style.display = 'none';
        }

        // Show clue content
        function showClue(questionId) {
            document.getElementById(`clue-warning-${questionId}`).style.display = 'none';
            document.getElementById(`clue-content-${questionId}`).style.display = 'block';
            
            // Mark that clue was used for this question
            sectionState.cluesUsed[questionId] = true;
            
            // Hide the clue button
            const clueBtn = document.querySelector(`.clue-btn[data-question="${questionId}"]`);
            if (clueBtn) clueBtn.style.display = 'none';
        }

        // Update progress tracking
        function updateProgress() {
            let answeredCount = 0;
            
            // Check Q1 (multi-select) - needs all 3 selections since there are exactly 3 options
            // The question asks to identify THREE specific weaknesses, and there are exactly 3 options
            if (sectionState.responses['q1'] && Array.isArray(sectionState.responses['q1']) && sectionState.responses['q1'].length === 3) {
                answeredCount++;
            } else {
                console.log('Q1 not completed, current selections:', sectionState.responses['q1'] ? sectionState.responses['q1'].length : 0);
            }
            
            // Check Q2 (textarea) - needs some text
            if (sectionState.responses['q2'] && sectionState.responses['q2'].trim().length > 0) {
                answeredCount++;
            } else {
                console.log('Q2 not completed, current length:', sectionState.responses['q2'] ? sectionState.responses['q2'].trim().length : 0);
            }
            
            sectionState.answeredQuestions = answeredCount;
            progressText.textContent = `${sectionState.answeredQuestions}/${sectionState.totalQuestions}`;
            const progressPercent = (sectionState.answeredQuestions / sectionState.totalQuestions) * 100;
            progressFill.style.width = `${progressPercent}%`;
            
            // Enable submit button when all questions are answered
            if (sectionState.answeredQuestions === sectionState.totalQuestions) {
                submitBtn.disabled = false;
            } else {
                submitBtn.disabled = true;
            }
        }

        // Timer functionality
        function startTimer() {
            const timer = setInterval(() => {
                sectionState.timeRemaining--;
                
                // Update display
                const minutes = Math.floor(sectionState.timeRemaining / 60);
                const seconds = sectionState.timeRemaining % 60;
                timeDisplay.textContent = `${minutes}:${seconds < 10 ? '0' : ''}${seconds}`;
                
                // Change color when time is running low (less than 2 minutes)
                if (sectionState.timeRemaining < 2 * 60) {
                    timeDisplay.style.color = '#e74c3c'; // Red color for urgency
                    timeDisplay.style.fontWeight = 'bold';
                }
                
                // Auto-submit when time runs out
                if (sectionState.timeRemaining <= 0) {
                    clearInterval(timer);
                    alert('Time is up! Your answers have been automatically saved. Moving to the results page.');
                    submitAssessment(true); // true indicates time expired
                }
            }, 1000);
        }

        // Go to previous section
        function goToPreviousSection() {
            // Check if the previous section is accessible
            const ethicalJudgmentCompleted = localStorage.getItem('ethical_judgment_completed');
            if (ethicalJudgmentCompleted === 'true') {
                alert("You have already completed the Ethical Judgment section and cannot return to it.");
                return;
            }
            
            // Save responses and clues used to localStorage
            localStorage.setItem('argument_quality_responses', JSON.stringify(sectionState.responses));
            localStorage.setItem('argument_quality_clues', JSON.stringify(sectionState.cluesUsed));
            
            // Redirect to previous section
            window.location.href = 'section_ethical_judgment.html';
        }

        // Submit assessment with confirmation
        function submitAssessment(timeExpired = false) {
            // If time has expired, proceed automatically without confirmation
            if (timeExpired) {
                // Save responses and clues used to localStorage
                localStorage.setItem('argument_quality_responses', JSON.stringify(sectionState.responses));
                localStorage.setItem('argument_quality_clues', JSON.stringify(sectionState.cluesUsed));
                // Mark this section as completed
                localStorage.setItem('argument_quality_completed', 'true');
                // Redirect to results page
                window.location.href = 'assessment_results.html';
                return;
            }
            
            // Show confirmation dialog
            if (confirm("Are you sure you want to submit the assessment? You will not be able to return to this section once you leave.")) {
                // Save responses and clues used to localStorage
                localStorage.setItem('argument_quality_responses', JSON.stringify(sectionState.responses));
                localStorage.setItem('argument_quality_clues', JSON.stringify(sectionState.cluesUsed));
                // Mark this section as completed
                localStorage.setItem('argument_quality_completed', 'true');
                // Redirect to results page
                window.location.href = 'assessment_results.html';
            }
        }
        
        // Check if user is trying to access a completed section
        function checkSectionAccess() {
            // Check if the required previous sections are completed
            const legalKnowledgeCompleted = localStorage.getItem('legal_knowledge_completed');
            const caseAnalysisCompleted = localStorage.getItem('case_analysis_completed');
            const ethicalJudgmentCompleted = localStorage.getItem('ethical_judgment_completed');
            
            if (legalKnowledgeCompleted === 'true' && caseAnalysisCompleted === 'true' && ethicalJudgmentCompleted === 'true') {
                // User has completed all previous sections, they can access this section
                return true;
            }
            // User hasn't completed the required previous sections
            return false;
        }

        // Initialize the section when the page loads
        document.addEventListener('DOMContentLoaded', function() {
            // Check if user can access this section
            if (!checkSectionAccess()) {
                // Redirect to the last completed section
                const legalKnowledgeCompleted = localStorage.getItem('legal_knowledge_completed');
                const caseAnalysisCompleted = localStorage.getItem('case_analysis_completed');
                const ethicalJudgmentCompleted = localStorage.getItem('ethical_judgment_completed');
                
                if (ethicalJudgmentCompleted === 'true') {
                    window.location.href = 'section_ethical_judgment.html';
                } else if (caseAnalysisCompleted === 'true') {
                    window.location.href = 'section_case_analysis.html';
                } else if (legalKnowledgeCompleted === 'true') {
                    window.location.href = 'section_legal_knowledge.html';
                } else {
                    // This shouldn't happen, but redirect to first section just in case
                    window.location.href = 'section_legal_knowledge.html';
                }
                return;
            }
            
            initSection();
        });

    </script>
</body>
</html>